<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../../charts/js/lib/d3.js" charset="utf-8"></script>
		<title>MACD</title>
		<style type="text/css">
		</style>
	</head>
	<body>
		<script type="text/javascript">
		
		var log = console.log;

		var w = window,
		d = document,
		e = d.documentElement,
		g = d.getElementsByTagName('body')[0],
		cwidth = w.innerWidth || e.clientWidth || g.clientWidth,
		cheight = w.innerHeight|| e.clientHeight|| g.clientHeight;
		
		var margin = 35;
		var zoomMult = 1;
		
		var fast = '12',
		slow = '26',
		signal = '9',
		symbol = 'AAPL';
		
		interp = "monotone"
		
		function buildMacd(data) {
			var width = zoomMult * d3.max([data.length, cwidth]);
			//var height = zoomMult * cheight;
			var height = zoomMult * 150;
			var macdVals = data.map(function(d) { return d.MACD; })
			
			var chart = d3.select("body")
				.append("svg")
				.attr("width", width)
				.attr("height", height);
			
			var y = d3.scale.linear()
				.domain([d3.min(macdVals), d3.max(macdVals)])
				.range([height-margin, margin]);
				
			var x = d3.scale.linear()
				.domain([0, data.length])
				.range([margin, width-margin]);
			
			chart.selectAll("line.xTick")
				.data(x.ticks())
				.enter().append("line")
				.attr("class", "xTick")
				.attr("x1", x)
				.attr("x2", x)
				.attr("y1", margin)
				.attr("y2", height - margin)
				.attr("stroke", "#ccc");
	
			chart.selectAll("line.yTick")
				.data(y.ticks())
				.enter().append("line")
				.attr("class", "yTick")
				.attr("x1", margin)
				.attr("x2", width - margin)
				.attr("y1", y)
				.attr("y2", y)
				.attr("stroke", "#ccc");
				
			var macdLine = d3.svg.line()
				.x(function(d, i) { return x(i); })
				.y(function(d) { return y(d.MACD); })
				.interpolate(interp);
				
			//The line SVG Path we draw
			var lineGraph = chart.append("path")
				.attr("d", macdLine(data))
				.attr("stroke", "red")
				.attr("stroke-width", 1)
				.attr("fill", "none");
				
			var sigLine = d3.svg.line()
				.x(function(d, i) { return x(i); })
				.y(function(d) { return y(d.Sig); })
				.interpolate(interp);
				
			//The line SVG Path we draw
			var lineGraph = chart.append("path")
				.attr("d", sigLine(data))
				.attr("stroke", "blue")
				.attr("stroke-width", 1)
				.attr("fill", "none");
		}
		
		d3.json('http://localhost:8080/macd.json?fast='+fast+'&slow='+slow+'&symbol='+symbol+'&signal='+signal, buildMacd)
		</script>
	</body>